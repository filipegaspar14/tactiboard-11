<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TactiBoard 11 – Pessoal Profissional</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #0f172a;
  color: white;
}

header {
  padding: 15px;
  background: #111827;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
}

.container {
  display: flex;
  gap: 20px;
  padding: 20px;
}

.sidebar {
  width: 260px;
  background: #1f2937;
  padding: 15px;
  border-radius: 10px;
}

.sidebar input, .sidebar select {
  width: 100%;
  margin-bottom: 10px;
  padding: 8px;
  border-radius: 6px;
  border: none;
}

.sidebar button {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 8px;
  border: none;
  background: #22c55e;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

.plantel {
  margin-top: 15px;
}

.player-list {
  background: white;
  color: black;
  padding: 6px;
  margin-bottom: 5px;
  border-radius: 6px;
  cursor: pointer;
  text-align: center;
  font-weight: bold;
}

.field-container {
  flex: 1;
  text-align: center;
}

.field {
  width: 900px;
  height: 500px;
  background: linear-gradient(to right, #166534, #15803d);
  margin: auto;
  border-radius: 15px;
  position: relative;
  border: 5px solid white;
  box-shadow: 0 0 15px rgba(0,0,0,0.6);
}

/* Linhas de campo e áreas */
.line-mid, .line-goal, .line-area {
  position: absolute;
  background: white;
}

.line-mid { width: 2px; height: 100%; left: 50%; }
.circle-mid { position:absolute;width:120px;height:120px;border:2px solid white;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);}
.line-goal { width:2px;height:80px; left:10px; top:210px; }
.line-area { border:2px solid white; position:absolute; width:120px; height:180px; left:0px; top:160px; border-radius:10px; }

.player {
  position: absolute;
  width: 110px;
  height: 45px;
  border-radius: 10px;
  text-align: center;
  line-height: 45px;
  font-weight: bold;
  cursor: move;
  box-shadow: 0 3px 6px rgba(0,0,0,0.4);
}

/* Cores por posição */
.def { background:#f87171; color:white; } /* Defesa */
.mid { background:#60a5fa; color:white; } /* Meio */
.att { background:#facc15; color:black; } /* Ataque */
.gk  { background:#34d399; color:black; } /* Guarda-Redes */
</style>
</head>

<body>

<header>⚽ TactiBoard 11 – Pessoal Profissional</header>

<div class="container">

<div class="sidebar">
<input type="text" id="teamName" placeholder="Nome da Equipa">
<input type="text" id="opponent" placeholder="Adversário">
<input type="date" id="matchDate">
<input type="text" id="competition" placeholder="Competição">

<select id="formation">
<option value="433">4-3-3</option>
<option value="442">4-4-2</option>
<option value="352">3-5-2</option>
<option value="532">5-3-2</option>
</select>

<button onclick="generateFormation()">Aplicar Formação</button>
<button onclick="clearField()">Limpar Campo</button>
<button onclick="downloadPDF()">Download PDF</button>

<div class="plantel">
<h3>Plantel</h3>
<div id="playerList"></div>
<input type="text" id="newPlayer" placeholder="Adicionar jogador">
<button onclick="addPlayer()">Adicionar</button>
</div>
</div>

<div class="field-container">
<div class="field" id="field">
<div class="line-mid"></div>
<div class="circle-mid"></div>
</div>
</div>

</div>

<script>
let selectedPlayer = null;

// Adicionar jogador ao plantel lateral
function addPlayer() {
  const name = document.getElementById("newPlayer").value;
  if (!name) return;
  const div = document.createElement("div");
  div.className = "player-list";
  div.innerText = name;
  div.onclick = () => selectedPlayer = name;
  document.getElementById("playerList").appendChild(div);
  document.getElementById("newPlayer").value = "";
}

// Limpar campo
function clearField() {
  generateFormation();
}

// Função principal: gerar formações
function generateFormation() {
  const field = document.getElementById("field");
  field.innerHTML = '<div class="line-mid"></div><div class="circle-mid"></div>';

  const formation = document.getElementById("formation").value;
  let positions = [];

  if (formation === "433") positions = [
    [50,250,'gk'],[200,80,'def'],[200,200,'def'],[200,320,'def'],[200,440,'def'],
    [400,120,'mid'],[400,250,'mid'],[400,380,'mid'],
    [650,80,'att'],[650,250,'att'],[650,420,'att']
  ];
  if (formation === "442") positions = [
    [50,250,'gk'],[200,80,'def'],[200,200,'def'],[200,320,'def'],[200,440,'def'],
    [400,80,'mid'],[400,200,'mid'],[400,320,'mid'],[400,440,'mid'],
    [650,170,'att'],[650,330,'att']
  ];
  if (formation === "352") positions = [
    [50,250,'gk'],[200,150,'def'],[200,250,'def'],[200,350,'def'],
    [400,60,'mid'],[400,160,'mid'],[400,250,'mid'],[400,340,'mid'],[400,440,'mid'],
    [650,180,'att'],[650,320,'att']
  ];
  if (formation === "532") positions = [
    [50,250,'gk'],[200,60,'def'],[200,150,'def'],[200,250,'def'],[200,350,'def'],[200,440,'def'],
    [400,150,'mid'],[400,250,'mid'],[400,350,'mid'],
    [650,180,'att'],[650,320,'att']
  ];

  positions.forEach(pos => {
    const div = document.createElement("div");
    div.className = "player " + pos[2];
    div.contentEditable = true;
    div.style.left = pos[0] + "px";
    div.style.top = pos[1] + "px";
    div.onclick = () => { if(selectedPlayer){div.innerText=selectedPlayer;selectedPlayer=null;} };
    makeDraggable(div);
    field.appendChild(div);
  });
}

// Drag & Drop
function makeDraggable(el){
  el.onmousedown = function(e){
    e.preventDefault();
    let shiftX = e.clientX - el.getBoundingClientRect().left;
    let shiftY = e.clientY - el.getBoundingClientRect().top;
    function moveAt(pageX,pageY){
      el.style.left = pageX - shiftX - el.parentElement.getBoundingClientRect().left+'px';
      el.style.top = pageY - shiftY - el.parentElement.getBoundingClientRect().top+'px';
    }
    function onMouseMove(e){ moveAt(e.pageX,e.pageY);}
    document.addEventListener('mousemove',onMouseMove);
    document.onmouseup = function(){
      document.removeEventListener('mousemove',onMouseMove);
      document.onmouseup=null;
    }
  };
}

// Download PDF
async function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const field = document.getElementById("field");
  const canvas = await html2canvas(field);
  const imgData = canvas.toDataURL("image/png");

  const pdf = new jsPDF("landscape");
  pdf.setFontSize(14);
  pdf.text(document.getElementById("teamName").value||"Equipa",10,10);
  pdf.text("vs "+(document.getElementById("opponent").value||"Adversário"),10,20);
  pdf.text(document.getElementById("competition").value||"",10,30);

  pdf.addImage(imgData,"PNG",10,40,270,150);
  pdf.save("TactiBoard-Profissional.pdf");
}

generateFormation();
</script>

</body>
</html>
