<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TactiBoard 11 – Profissional</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #0f172a;
  color: white;
}
header {
  padding: 15px;
  background: #111827;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
}
.container {
  display: flex;
  gap: 20px;
  padding: 20px;
}
.sidebar {
  width: 260px;
  background: #1f2937;
  padding: 15px;
  border-radius: 10px;
}
.sidebar input, .sidebar select {
  width: 100%;
  margin-bottom: 10px;
  padding: 8px;
  border-radius: 6px;
  border: none;
}
.sidebar button {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 8px;
  border: none;
  background: #22c55e;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
.plantel {
  margin-top: 15px;
}
.player-list {
  background: white;
  color: black;
  padding: 6px;
  margin-bottom: 5px;
  border-radius: 6px;
  cursor: pointer;
  text-align: center;
  font-weight: bold;
}
.player-list[contenteditable="true"] {
  outline: 1px solid #ccc;
}
.field-container {
  flex: 1;
  text-align: center;
}
.field {
  width: 900px;
  height: 500px;
  background: linear-gradient(to right, #166534, #15803d);
  margin: auto;
  border-radius: 15px;
  position: relative;
  border: 5px solid white;
  box-shadow: 0 0 15px rgba(0,0,0,0.6);
}
.line-mid, .circle-mid {
  position: absolute;
}
.line-mid {
  width: 2px;
  height: 100%;
  background: white;
  left: 50%;
}
.circle-mid {
  width: 120px;
  height: 120px;
  border: 2px solid white;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
}
.player {
  position: absolute;
  width: 110px;
  height: 45px;
  border-radius: 10px;
  text-align: center;
  line-height: 45px;
  font-weight: bold;
  cursor: move;
  box-shadow: 0 3px 6px rgba(0,0,0,0.4);
}
/* Cores por posição */
.def { background:#f87171; color:white; }
.mid { background:#60a5fa; color:white; }
.att { background:#facc15; color:black; }
.gk  { background:#34d399; color:black; }
</style>
</head>

<body>

<header>⚽ TactiBoard 11 – Profissional</header>

<div class="container">

<div class="sidebar">
<input type="text" id="teamName" placeholder="Nome da Equipa">
<input type="text" id="opponent" placeholder="Adversário">
<input type="date" id="matchDate">
<input type="text" id="competition" placeholder="Competição">

<select id="formation">
<option value="433">4-3-3</option>
<option value="442">4-4-2</option>
<option value="352">3-5-2</option>
<option value="532">5-3-2</option>
<option value="352Atual">3-5-2 ATUAL</option>
</select>

<button onclick="generateFormation()">Aplicar Formação</button>
<button onclick="clearField()">Limpar Campo</button>
<button onclick="downloadPDF()">Download PDF</button>

<div class="plantel">
<h3>Plantel</h3>
<div id="playerList"></div>
<input type="text" id="newPlayer" placeholder="Adicionar jogador">
<button onclick="addPlayer()">Adicionar</button>
<p style="font-size:12px;color:#aaa;">Clique no nome do jogador para editar.</p>
</div>
</div>

<div class="field-container">
<div class="field" id="field">
<div class="line-mid"></div>
<div class="circle-mid"></div>
</div>
</div>

</div>

<script>
let selectedPlayer = null;

// Adicionar jogador ao plantel lateral
function addPlayer() {
  const name = document.getElementById("newPlayer").value;
  if (!name) return;
  const div = document.createElement("div");
  div.className = "player-list";
  div.innerText = name;
  div.contentEditable = "true"; // permite corrigir nomes depois
  div.onclick = () => selectedPlayer = name;
  document.getElementById("playerList").appendChild(div);
  document.getElementById("newPlayer").value = "";
}

// Limpar campo
function clearField() { generateFormation(); }

// Gerar formações
function generateFormation() {
  const field = document.getElementById("field");
  field.innerHTML = '<div class="line-mid"></div><div class="circle-mid"></div>';
  const formation = document.getElementById("formation").value;
  let positions = [];

  if (formation === "433") positions = [
    [50,250,'gk'],
    [200,80,'def'],[200,200,'def'],[200,320,'def'],[200,440,'def'],
    [400,120,'mid'],[400,250,'mid'],[400,380,'mid'],
    [650,80,'att'],[650,250,'att'],[650,420,'att']
  ];

  if (formation === "442") positions = [
    [50,250,'gk'],
    [200,80,'def'],[200,200,'def'],[200,320,'def'],[200,440,'def'],
    [400,80,'mid'],[400,200,'mid'],[400,320,'mid'],[400,440,'mid'],
    [650,170,'att'],[650,330,'att']
  ];

  if (formation === "352") positions = [
    [50,250,'gk'],
    [200,150,'def'],[200,250,'def'],[200,350,'def'],
    [400,60,'mid'],[400,160,'mid'],[400,250,'mid'],[400,340,'mid'],[400,440,'mid'],
    [650,180,'att'],[650,320,'att']
  ];

  if (formation === "532") positions = [
    [50,250,'gk'],
    [200,60,'def'],[200,150,'def'],[200,250,'def'],[200,350,'def'],[200,440,'def'],
    [400,150,'mid'],[400,250,'mid'],[400,350,'mid'],
    [650,180,'att'],[650,320,'att']
  ];

  // Nova formação: 3-5-2 ATUAL
  if (formation === "352Atual") positions = [
    [50,250,'gk'],           // GR
    [200,100,'def'],[200,250,'def'],[200,400,'def'],  // 3 defesas
    [300,50,'mid'], [350,150,'mid'],  // Alas recuados
    [350,250,'mid'],                 // 10 central
    [300,350,'mid'], [350,450,'mid'],  // Alas avançados / interiores
    [500,150,'att'], [500,350,'att']  // 2 avançados
  ];

  positions.forEach(pos => {
    const div = document.createElement("div");
    div.className = "player "+pos[2];
    div.contentEditable = true; // permite editar nome diretamente no campo
    div.style.left = pos[0]+"px";
    div.style.top = pos[1]+"px";
    div.onclick = ()=>{ if(selectedPlayer){div.innerText=selectedPlayer;selectedPlayer=null;} };
    makeDraggable(div);
    field.appendChild(div);
  });
}

// Drag & Drop
function makeDraggable(el){
  el.onmousedown = function(e){
    e.preventDefault();
    let shiftX = e.clientX - el.getBoundingClientRect().left;
    let shiftY = e.clientY - el.getBoundingClientRect().top;
    function moveAt(pageX,pageY){
      el.style.left = pageX-shiftX-el.parentElement.getBoundingClientRect().left+'px';
      el.style.top = pageY-shiftY-el.parentElement.getBoundingClientRect().top+'px';
    }
    function onMouseMove(e){ moveAt(e.pageX,e.pageY);}
    document.addEventListener('mousemove',onMouseMove);
    document.onmouseup = function(){
      document.removeEventListener('mousemove',onMouseMove);
      document.onmouseup=null;
    }
  };
}

// PDF fiel ao site
async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const field = document.getElementById("field");

  const canvas = await html2canvas(field, { scale:3, useCORS:true, allowTaint:true, backgroundColor:null });
  const imgData = canvas.toDataURL("image/png");

  const pdf = new jsPDF("landscape", "mm", "a4");

  // Tabela de informações
  const startX = 10;
  let startY = 10;
  const cellWidth = 50;
  const cellHeight = 8;

  const gameInfo = [
    ["Equipa", document.getElementById("teamName").value || "Equipa"],
    ["Adversário", document.getElementById("opponent").value || "Adversário"],
    ["Competição", document.getElementById("competition").value || ""],
    ["Data", document.getElementById("matchDate").value || ""],
    ["Formação", document.getElementById("formation").value || ""]
  ];

  gameInfo.forEach((row,i)=>{
    pdf.rect(startX,startY+i*cellHeight,cellWidth,cellHeight);
    pdf.rect(startX+cellWidth,startY+i*cellHeight,cellWidth*2,cellHeight);
    pdf.text(row[0], startX+2, startY+i*cellHeight+6);
    pdf.text(row[1], startX+cellWidth+2, startY+i*cellHeight+6);
  });

  const imgWidth = 270; // largura em mm
  const imgHeight = (canvas.height / canvas.width) * imgWidth; 
  pdf.addImage(imgData,"PNG",10,startY + gameInfo.length*cellHeight + 5,imgWidth,imgHeight);

  pdf.save("TactiBoard-Pro-Fiel.pdf");
}

generateFormation();
</script>

</body>
</html>
