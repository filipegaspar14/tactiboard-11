<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TactiBoard 11 – Campo Verde 2D</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {margin:0;font-family:'Segoe UI',sans-serif;background:#fff;color:black;}
header {padding:15px;background:#22c55e;text-align:center;font-size:24px;font-weight:bold;color:white;}
.container {display:flex;gap:20px;padding:20px;}
.sidebar {width:280px;background:#e0f2e9;padding:15px;border-radius:10px;}
.sidebar input,.sidebar select {width:100%;margin-bottom:10px;padding:8px;border-radius:6px;border:none;}
.sidebar button {width:100%;padding:10px;margin-top:5px;border-radius:8px;border:none;background:#16a34a;color:white;font-weight:bold;cursor:pointer;}
.plantel {margin-top:15px;}
.player-list {background:white;color:black;padding:6px;margin-bottom:5px;border-radius:6px;cursor:pointer;text-align:center;font-weight:bold;}
.player-list[contenteditable="true"] {outline:1px solid #ccc;}
.field-container {flex:1;text-align:center;}
.field {width:900px;height:500px;background:#a0e4a0;margin:auto;position:relative;border:3px solid white;}
.player {position:absolute;width:80px;height:40px;border-radius:8px;text-align:center;line-height:40px;font-weight:bold;cursor:move;background:white;color:black;}
</style>
</head>

<body>

<header>⚽ TactiBoard 11 – Campo Verde 2D</header>

<div class="container">

<div class="sidebar">
<input type="text" id="teamName" placeholder="Nome da Equipa">
<input type="text" id="opponent" placeholder="Adversário">
<input type="date" id="matchDate">
<input type="text" id="competition" placeholder="Competição">

<select id="formation">
<option value="352Atual" selected>3-5-2 ATUAL (Preset)</option>
<option value="433">4-3-3</option>
<option value="442">4-4-2</option>
<option value="352">3-5-2</option>
<option value="532">5-3-2</option>
</select>

<button onclick="generateFormation()">Aplicar Formação</button>
<button onclick="clearField()">Limpar Campo</button>
<button onclick="downloadPDF()">Download PDF</button>

<div class="plantel">
<h3>Plantel (18 jogadores)</h3>
<div id="playerList"></div>
<input type="text" id="newPlayer" placeholder="Adicionar jogador">
<button onclick="addPlayer()">Adicionar</button>
<p style="font-size:12px;color:#555;">Clique no nome do jogador para editar</p>
</div>
</div>

<div class="field-container">
<div class="field" id="field"></div>
</div>

</div>

<script>
let selectedPlayer = null;

// Inicializa 18 espaços no plantel
function initPlantel(){
  const list = document.getElementById("playerList");
  list.innerHTML="";
  for(let i=0;i<18;i++){
    const div=document.createElement("div");
    div.className="player-list";
    div.contentEditable="true";
    div.innerText="";
    div.onclick=()=>selectedPlayer=null;
    list.appendChild(div);
  }
}

// Adicionar jogador extra
function addPlayer(){
  const name = document.getElementById("newPlayer").value;
  if(!name) return;
  const div=document.createElement("div");
  div.className="player-list";
  div.innerText=name;
  div.contentEditable="true";
  div.onclick=()=>selectedPlayer=name;
  document.getElementById("playerList").appendChild(div);
  document.getElementById("newPlayer").value="";
}

// Limpar campo
function clearField(){ generateFormation(); }

// Drag & Drop
function makeDraggable(el){
  el.onmousedown=function(e){
    e.preventDefault();
    let shiftX=e.clientX-el.getBoundingClientRect().left;
    let shiftY=e.clientY-el.getBoundingClientRect().top;
    function moveAt(pageX,pageY){ el.style.left=pageX-shiftX-el.parentElement.getBoundingClientRect().left+'px'; el.style.top=pageY-shiftY-el.parentElement.getBoundingClientRect().top+'px';}
    function onMouseMove(e){ moveAt(e.pageX,e.pageY);}
    document.addEventListener('mousemove',onMouseMove);
    document.onmouseup=function(){document.removeEventListener('mousemove',onMouseMove);document.onmouseup=null;}
  };
}

// Campo principal 2D com retângulos para jogadores
function generateFormation(){
  const field=document.getElementById("field");
  field.innerHTML='';

  const w=900,h=500;

  // 3-5-2 ATUAL como preset (11 jogadores)
  const positions=[
    [0.05*w,0.5*h],           // GR
    [0.2*w,0.35*h],[0.2*w,0.5*h],[0.2*w,0.65*h], // 3 Centrais
    [0.4*w,0.15*h],[0.4*w,0.35*h],[0.4*w,0.5*h],[0.4*w,0.65*h],[0.4*w,0.85*h], // 5 Médios (incluindo 10 ofensivo)
    [0.65*w,0.35*h],[0.65*w,0.65*h] // 2 Avançados
  ];

  positions.forEach(pos=>{
    const div=document.createElement("div");
    div.className="player";
    div.contentEditable="true";
    div.style.left=pos[0]+"px"; div.style.top=pos[1]+"px";
    div.innerText="";
    makeDraggable(div);
    field.appendChild(div);
  });
}

// PDF fiel
async function downloadPDF(){
  const { jsPDF }=window.jspdf;
  const field=document.getElementById("field");
  const canvas=await html2canvas(field,{scale:3,useCORS:true,allowTaint:true,backgroundColor:null});
  const imgData=canvas.toDataURL("image/png");

  const pdf=new jsPDF("landscape","mm","a4");
  const startX=10,startY=10,cellWidth=50,cellHeight=8;
  const gameInfo=[["Equipa",document.getElementById("teamName").value||"Equipa"],["Adversário",document.getElementById("opponent").value||"Adversário"],["Competição",document.getElementById("competition").value||""],["Data",document.getElementById("matchDate").value||""],["Formação",document.getElementById("formation").value||""]];
  gameInfo.forEach((row,i)=>{pdf.rect(startX,startY+i*cellHeight,cellWidth,cellHeight);pdf.rect(startX+cellWidth,startY+i*cellHeight,cellWidth*2,cellHeight);pdf.text(row[0],startX+2,startY+i*cellHeight+6);pdf.text(row[1],startX+cellWidth+2,startY+i*cellHeight+6);});
  const imgWidth=270;
  const imgHeight=(canvas.height/canvas.width)*imgWidth;
  pdf.addImage(imgData,"PNG",10,startY+gameInfo.length*cellHeight+5,imgWidth,imgHeight);
  pdf.save("TactiBoard-2D-Verde.pdf");
}

// Inicializa plantel e formação preset
initPlantel();
generateFormation();
</script>

</body>
</html>
